<!doctype html><html lang=zh-cn class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><link rel=canonical type=text/html href=https://www.kubeclipper.io/docs/><link rel=alternate type=application/rss+xml href=https://www.kubeclipper.io/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>文档 | KubeClipper</title><meta name=description content><meta property="og:title" content="文档"><meta property="og:description" content="☸️ Manage kubernetes in the most light and convenient way ☸️"><meta property="og:type" content="website"><meta property="og:url" content="https://www.kubeclipper.io/docs/"><meta property="og:site_name" content="KubeClipper"><meta itemprop=name content="文档"><meta itemprop=description content="☸️ Manage kubernetes in the most light and convenient way ☸️"><meta name=twitter:card content="summary"><meta name=twitter:title content="文档"><meta name=twitter:description content="☸️ Manage kubernetes in the most light and convenient way ☸️"><link rel=preload href=/scss/main.min.53f5c523adecbae2f6271a40d6b3f66b03402389ec50b0ba967b0d9974dbbe6e.css as=style><link href=/scss/main.min.53f5c523adecbae2f6271a40d6b3f66b03402389ec50b0ba967b0d9974dbbe6e.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30" viewBox="0 0 200 200" enable-background="new 0 0 200 200"><image id="image0" width="200" height="200" x="0" y="0" href="data:image/png;base64,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 RK5CYII="/></svg></span><span class=navbar-brand__name>KubeClipper</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>文档</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>博客</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>社区</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>latest</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>vlatest (latest)</a>
<a class=dropdown-item href=/v1.3>v1.3</a>
<a class=dropdown-item href=/v1.2>v1.2</a>
<a class=dropdown-item href=/v1.1>v1.1</a></div></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>简体中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/en/docs/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; 站内搜索…" aria-label=站内搜索… autocomplete=off data-offline-search-index-json-src=/offline-search-index.dcc366edc66223cd184b46459c0605ae.json data-offline-search-base-href=/ data-offline-search-max-results=25></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/docs/>返回本页常规视图</a>.</p></div><h1 class=title>文档</h1><ul><li>1: <a href=#pg-6e17e09fffc1050f46600282def85180>概述</a></li><ul></ul><li>2: <a href=#pg-93aadc1aba179e6928539400a09b9e4e>快速开始</a></li><ul><li>2.1: <a href=#pg-51e07dd308860dc8b1808e7299ac75d8>部署 AIO</a></li><li>2.2: <a href=#pg-45c14578741098628f1d483b1891e15d>使用 Kubeclipper 离线创建 kubernetes 集群</a></li><li>2.3: <a href=#pg-dcae4c3cb97ad8ed34622bd2f2d5bbab>制作 K8S 组件离线安装包</a></li></ul><li>3: <a href=#pg-a07813ac798dd2637717ce2e67c448bd>部署文档</a></li><ul><li>3.1: <a href=#pg-1ed184c63a9ba32659457db911ea314c>部署高可用 KubeClipper</a></li></ul><li>4: <a href=#pg-8dbd4e302cd86a4d0f71f71ce3b300de>使用手册</a></li><ul><li>4.1: <a href=#pg-2cc05f33f011eb2f0671dd748cff9826>创建集群</a></li><li>4.2: <a href=#pg-d02d74740bfa769ed1533f083ba56ac2>集群托管</a></li><li>4.3: <a href=#pg-a8bf4ad6bad192cf81433dc9082057f8>集群管理</a></li><li>4.4: <a href=#pg-14a1d24a0e318e4086c90931bd9e8c35>节点管理</a></li><li>4.5: <a href=#pg-9db4787abe05db7c233072bf3fa9f94e>访问控制</a></li></ul><li>5: <a href=#pg-2a24abb89b7115d59d639d3389ce3c9b>常见问题</a></li><ul><li>5.1: <a href=#pg-54fa90c08fd01c12b3bbec84936325aa>通过 kcctl 命令创建集群错误</a></li></ul><li>6: <a href=#pg-8efbf7499fe9c7bde8d2c1bb7ff6ee3c>贡献指南</a></li><ul></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-6e17e09fffc1050f46600282def85180>1 - 概述</h1><div class=lead>Manage kubernetes in the most light and convenient way ☸️</div><h2 id=kubeclipper-是什么>KubeClipper 是什么？</h2><p>KubeClipper 旨在提供易使用、易运维、极轻量、生产级的 Kubernetes 多集群全生命周期管理服务，让运维工程师从繁复的配置和晦涩的命令行中解放出来，实现一站式管理跨区域、跨基础设施的多 kubernetes 集群。</p><h2 id=为什么需要-kubeclipper>为什么需要 KubeClipper？</h2><p>云原生时代，Kubernetes 已毋庸置疑地成为容器编排的事实标准。虽然有诸多辅助 kubernetes 集群安装和管理的工具，但搭建和运维一套生产级别的 kubernetes 集群仍然十分复杂。九州云在大量的服务和实践过程中，沉淀出一个极轻量、易使用的图形化界面 Kubernetes 多集群管理工具—— KubeClipper。</p><p>KubeClipper 在完全兼容原生 Kubernetes 的前提下，基于社区广泛使用的 kubeadm 工具进行二次封装，提供在企业自有基础设施中快速部署 kubernetes 集群和持续化全生命周期管理（安装、卸载、升级、扩缩容、远程访问等）能力，支持在线、代理、离线等多种部署方式，还提供了丰富可扩展的 CRI、CNI、CSI、以及各类 CRD 组件的管理服务。</p><p>与现有的 Sealos、KubeKey、Kubeasz、KubeOperator、K0S 等 kubernetes 生命周期管理工具相比，KubeClipper 更贴近开放原生、轻量便捷、稳定易用。</p><ul><li><a href=/docs/getting-started/>快速开始</a>: Learn how to get started with Kubeclipper</li><li><a href=/docs/tutorials>用户手册</a>: Check out some example code!</li></ul><h2 id=kubeclipper-架构设计>KubeClipper 架构设计</h2><h3 id=核心架构>核心架构</h3><p><img src=/images/docs-overview/kc-arch2.png alt></p><p>KubeClipper 分为三个部分：</p><ul><li>kc-server：原则上部署在独立节点，负责收集节点上报信息，分发前端操作任务至指定 kc-agent 并汇总执行结果等，是 KubeClipper 控制核心。</li><li>kc-agent: 部署在纳管节点，通过消息队列（内置 nats）与 kc-server 通信，负责上报节点信息以及处理下发任务并执行，是 KubeClipper 节点代理工具。</li><li>kcctl: KubeClipper 的终端命令行工具，可快捷高效的部署、管理 KubeClipper 集群，能够替代大多数页面操作。</li></ul><h3 id=节点纳管>节点纳管</h3><p><img src=/images/docs-overview/kc-arch.png alt></p><h3 id=部署网络模型>部署网络模型</h3><p><img src=/images/docs-overview/kc-network.png alt></p><p>KubeClipper 支持可以通过参数配置来部署分层网络模型，以下是不同网络的概要：</p><p>运维管理网络(Management Network):<br>在 <code>kcctl deploy</code> 部署 KubeClipper 集群时，可通过 <code>--ip-detect</code> 参数指定网卡接口，默认为 <code>first-found</code>。
该网卡接口对应的 IP 地址即是 <code>kc-server</code> 与 <code>kc-agent</code> 的路由地址。</p><p>K8S 主机网络(K8S Host Network):<br>在 <code>kcctl deploy</code> 部署 KubeClipper 集群时，可通过 <code>--node-ip-detct</code> 参数指定网卡接口，默认继承 <code>--ip-detect</code> 参数值，亦可独立设置。
该网卡接口对应的 IP 地址即是 K8S 的节点路由地址。</p><p>K8S Pod 网络(SDN Pod Network):<br>在安装 K8S 集群时，可通过填入 CNI 的 <code>POD 网路底层</code> 指定网卡接口，默认为 <code>first-found</code>。
该网卡接口对应的 IP 地址即是 K8S POD 网路底层的路由地址。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-93aadc1aba179e6928539400a09b9e4e>2 - 快速开始</h1><div class=lead>快速搭建体验平台功能</div><p>对于初次接触 KubeClipper 并想快速上手的用户，建议使用 All-in-One 安装模式，它能够帮助您零配置快速部署 KubeClipper。</p><h3 id=准备工作>准备工作</h3><p>KubeClipper 本身并不会占用太多资源，但是为了后续更好的运行 Kubernetes 建议硬件配置不低于最低要求。</p><p>您仅需参考以下对机器硬件和操作系统的要求准备一台主机。</p><h4 id=硬件推荐配置>硬件推荐配置</h4><ul><li>确保您的机器满足最低硬件要求：CPU >= 2 核，内存 >= 2GB。</li><li>操作系统：CentOS 7.x / Ubuntu 18.04 / Ubuntu 20.04。</li></ul><h4 id=节点要求>节点要求</h4><ul><li>节点必须能够通过 <code>SSH</code> 连接。</li><li>节点上可以使用 <code>sudo</code> / <code>curl</code> / <code>wget</code> / <code>tar</code> 命令。</li></ul><blockquote><p>建议您的操作系统处于干净状态（不安装任何其他软件），否则可能会发生冲突。</p></blockquote><h3 id=部署-kubeclipper>部署 KubeClipper</h3><h4 id=下载-kcctl>下载 kcctl</h4><p>KubeClipper 提供了命令行工具🔧 kcctl 以简化运维工作，您可以直接使用以下命令下载最新版 kcctl：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh | bash -</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 如果你在中国， 你可以在安装时使用 cn  环境变量, 此时我们会使用 registry.aliyuncs.com/google_containers 代替 k8s.gcr.io</span>
</span></span><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> <span style=color:#000>KC_REGION</span><span style=color:#ce5c00;font-weight:700>=</span>cn bash -
</span></span></code></pre></div><blockquote><p>您也可以在 <a href=https://github.com/kubeclipper/kubeclipper/releases>GitHub Release Page</a> 下载指定版本。</p></blockquote><p>通过以下命令检测是否安装成功:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl version
</span></span></code></pre></div><h4 id=开始安装>开始安装</h4><p>在本快速入门教程中，您只需执行一个命令即可安装 KubeClipper，其模板如下所示：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy
</span></span></code></pre></div><p>若使用 ssh passwd 方式则命令如下所示:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy --user root --passwd <span style=color:#000>$SSH_PASSWD</span>
</span></span></code></pre></div><p>私钥方式如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy --user root --pk-file <span style=color:#000>$SSH_PRIVATE_KEY</span>
</span></span></code></pre></div><blockquote><p>您只需要提供 ssh user 以及 ssh passwd 或者 ssh 私钥即可在本机部署 KubeClipper。</p></blockquote><p>执行该命令后，Kcctl 将检查您的安装环境，若满足条件将会进入安装流程。在打印出如下的 KubeClipper banner 后即表示安装完成。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic> _   __      _          _____ _ _
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>| | / /     | |        /  __ \ (_)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>| |/ / _   _| |__   ___| /  \/ |_ _ __  _ __   ___ _ __
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>|    \| | | | &#39;_ \ / _ \ |   | | | &#39;_ \| &#39;_ \ / _ \ &#39;__|
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>| |\  \ |_| | |_) |  __/ \__/\ | | |_) | |_) |  __/ |
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>\_| \_/\__,_|_.__/ \___|\____/_|_| .__/| .__/ \___|_|
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>                                 | |   | |
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>                                 |_|   |_|
</span></span></span></code></pre></div><h3 id=登录控制台>登录控制台</h3><p>安装完成后，打开浏览器，访问 <code>http://$IP</code> 即可进入 KubeClipper 控制台。</p><p><img src=/images/docs-quickstart/console-login.png alt=console></p><p>您可以使用默认帐号密码 <code>admin / Thinkbig1</code> 进行登录。</p><blockquote><p>您可能需要配置端口转发规则并在安全组中开放端口，以便外部用户访问控制台。</p></blockquote><h3 id=创建-kubernetes-集群>创建 kubernetes 集群</h3><p>部署成功后您可以使用 <strong>kcctl 工具</strong>或者通过<strong>控制台</strong>创建 kubernetes 集群。在本快速入门教程中使用 kcctl 工具进行创建。</p><p>首先使用默认帐号密码进行登录获取 token，便于后续 kcctl 和 kc-server 进行交互。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl login -H http://localhost -u admin -p Thinkbig1
</span></span></code></pre></div><p>然后使用以下命令创建 kubernetes 集群:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>NODE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kcctl get node -o yaml<span style=color:#000;font-weight:700>|</span>grep ipv4DefaultIP:<span style=color:#000;font-weight:700>|</span>sed <span style=color:#4e9a06>&#39;s/ipv4DefaultIP: //&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kcctl create cluster --master <span style=color:#000>$NODE</span> --name demo --untaint-master
</span></span></code></pre></div><p>大概 3 分钟左右即可完成集群创建,也可以使用以下命令查看集群状态</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl get cluster -o yaml<span style=color:#000;font-weight:700>|</span>grep status -A5
</span></span></code></pre></div><blockquote><p>您也可以进入控制台查看实时日志。</p></blockquote><p>进入 Running 状态即表示集群安装完成,您可以使用 <code>kubectl get cs</code> 命令来查看集群健康状况。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-51e07dd308860dc8b1808e7299ac75d8>2.1 - 部署 AIO</h1><div class=lead>部署 AIO 环境</div><p>对于初次接触 KubeClipper 并想快速上手的用户，建议使用 AIO（即 All-in-One，使用单个节点安装 KubeClipper）模式，它能够帮助您零配置快速部署 KubeClipper。</p><h2 id=部署-kubeclipper>部署 KubeClipper</h2><h3 id=下载并安装-kcctl>下载并安装 kcctl</h3><p>KubeClipper 提供了命令行工具🔧 kcctl 以简化运维工作，您可以直接使用以下命令下载最新版 kcctl：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 默认安装最新的发行版</span>
</span></span><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> bash -
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装指定版本</span>
</span></span><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> <span style=color:#000>KC_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>v1.3.1 bash -
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 如果您在中国， 您可以在安装时使用 cn  环境变量, 此时 KubeClipper 会使用 registry.aliyuncs.com/google_containers 代替 k8s.gcr.io</span>
</span></span><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> <span style=color:#000>KC_REGION</span><span style=color:#ce5c00;font-weight:700>=</span>cn bash -
</span></span></code></pre></div><blockquote><p>您也可以在 <a href=https://github.com/kubeclipper/kubeclipper/releases>GitHub Release Page</a> 下载指定版本。</p></blockquote><p>可以通过以下命令验证 kcctl 是否安装成功:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 如果一切顺利，您将看到 kcctl 版本信息</span>
</span></span><span style=display:flex><span>kcctl version
</span></span></code></pre></div><h3 id=开始安装>开始安装</h3><p>您可以使用 <code>kcctl deploy</code> 快速安装部署 KubeClipper。kcctl 使用 SSH 访问最终部署 KubeClipper 的目标节点，因此需要您提供 SSH 访问凭证，传递凭证的方法如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Kcctl deploy <span style=color:#ce5c00;font-weight:700>[</span>--user &lt;username&gt;<span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>[</span>--passwd &lt;password&gt; <span style=color:#000;font-weight:700>|</span> --pk-file &lt;private key path&gt;<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用私钥</span>
</span></span><span style=display:flex><span>kcctl deploy --user root --pk-file /root/.ssh/id_rsa
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 使用密码</span>
</span></span><span style=display:flex><span>kcctl deploy --user root --passwd password
</span></span></code></pre></div><p>执行 <code>kcctl deploy</code> 命令 kcctl 将会检查您的安装环境，若满足条件将自动进入安装流程。若您看到如下 KubeClipper banner 后即表示安装成功。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic> _   __      _          _____ _ _
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>| | / /     | |        /  __ \ (_)
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>| |/ / _   _| |__   ___| /  \/ |_ _ __  _ __   ___ _ __
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>|    \| | | | &#39;_ \ / _ \ |   | | | &#39;_ \| &#39;_ \ / _ \ &#39;__|
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>| |\  \ |_| | |_) |  __/ \__/\ | | |_) | |_) |  __/ |
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>\_| \_/\__,_|_.__/ \___|\____/_|_| .__/| .__/ \___|_|
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>                                 | |   | |
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>                                 |_|   |_|
</span></span></span></code></pre></div><blockquote><p>您也可以部署 master 版本的 KubeClipper，来体验最新的功能特性（master 版本没有经过严格验证，可能包含影响体验的未知错误）</p><ol><li>安装 master 版本 kcctl</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> <span style=color:#000>KC_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>master bash -
</span></span></code></pre></div><ol start=2><li>在安装服务器上设置环境变量</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>KC_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>master
</span></span></code></pre></div><ol start=3><li>以 AIO 方式部署 KubeClipper</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy
</span></span></code></pre></div></blockquote><h3 id=登录控制台>登录控制台</h3><p>安装完成后，打开浏览器，访问 <code>http://&lt;kc-server ip address></code> 即可进入 KubeClipper 控制台。(通常 kc-server ip 是您部署 kubeClipper 节点的 ip)</p><p><img src=/images/docs-quickstart/console-login.png alt=console></p><p>您可以使用默认帐号密码 <code>admin / Thinkbig1</code> 进行登录。</p><blockquote><p>您可能需要配置端口转发规则并在安全组中开放端口，以便外部用户访问控制台。</p></blockquote><h2 id=创建-kubernetes-集群>创建 Kubernetes 集群</h2><p>部署成功后您可以使用 <strong>kcctl 工具</strong>或者通过<strong>控制台</strong>创建 Kubernetes 集群。在本快速入门教程中使用 kcctl 工具进行创建。</p><p>首先使用默认帐号密码进行登录获取 token，便于后续 kcctl 和 kc-server 进行交互。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl login -H https://&lt;kc-server ip address&gt;:8080 -u admin -p Thinkbig1
</span></span></code></pre></div><p>通过以下命令创建 Kubernetes 集群:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000>NODE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>kcctl get node -o yaml<span style=color:#000;font-weight:700>|</span>grep ipv4DefaultIP:<span style=color:#000;font-weight:700>|</span>sed <span style=color:#4e9a06>&#39;s/ipv4DefaultIP: //&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kcctl create cluster --master <span style=color:#000>$NODE</span> --name demo --untaint-master
</span></span></code></pre></div><p>大概 3 分钟左右即可完成集群创建,您可以使用以下命令查看集群状态</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl get cluster -o yaml<span style=color:#000;font-weight:700>|</span>grep status -A5
</span></span></code></pre></div><blockquote><p>您也可以进入控制台查看实时日志。</p></blockquote><p>集群处于 Running 状态即表示集群安装完成,您可以使用 <code>kubectl get cs</code> 命令来查看集群健康状况。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-45c14578741098628f1d483b1891e15d>2.2 - 使用 Kubeclipper 离线创建 kubernetes 集群</h1><div class=lead>如何使用 KC 平台离线创建 kubernetes 集群</div><h2 id=1-进入创建界面>1. 进入创建界面</h2><p>登录 Kubeclipper 平台后点击如图所示按钮，进入集群创建界面</p><p><img src=/images/docs-quickstart/cluster-begin.png alt></p><h2 id=2-配置集群节点>2. 配置集群节点</h2><p>按照文字提示完成输入集群名称、选择节点等步骤</p><p>注意: master 节点数量不能为偶数</p><p><img src=/images/docs-quickstart/cluster-node-config.png alt></p><h2 id=3-配置集群>3. 配置集群</h2><p>此步骤用于配置集群网络以及数据库、容器运行时等组件</p><p>选择离线安装并填写首先搭建好的镜像仓库地址</p><p><img src=/images/docs-quickstart/cluster-config.png alt></p><h2 id=4-配置存储>4. 配置存储</h2><p>选择 nfs 存储，按照文字提示填写相应内容</p><p><img src=/images/docs-quickstart/cluster-storage-config.png alt></p><h2 id=5-安装完成>5. 安装完成</h2><p>完成所有配置确认安装</p><p><img src=/images/docs-quickstart/cluster-finish.png alt></p><p>安装成功，集群正常运行</p><p><img src=/images/docs-quickstart/cluster-successful.png alt></p></div><div class=td-content style=page-break-before:always><h1 id=pg-dcae4c3cb97ad8ed34622bd2f2d5bbab>2.3 - 制作 K8S 组件离线安装包</h1><div class=lead>制作 K8S 组件离线安装包</div><p>本文档介绍如何制作 K8S 组件离线安装包，对于没有外网的环境，可以通过离线安装包进行安装。</p><p>当前 kubeclipper v1.4 版本离线部署包中仅包含以下 K8S 组件：</p><ul><li>k8s: v1.27.4</li><li>containerd: 1.6.4</li><li>calico: v3.26.1</li></ul><p>对于有特殊需求的用户，可以通过本文档介绍的方法自行制作离线组件包，然后在 kubeclipper 中使用。</p><h2 id=1-准备工作>1. 准备工作</h2><p>按照 <a href=https://github.com/kubeclipper/kubeclipper>文档</a> 部署好 kubeclipper，确保 <code>kcctl</code> 命令可以正常使用。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl version
</span></span></code></pre></div><p>以下操作均在 kubeclipper 部署节点上执行，使用 <code>kcctl resource</code> 命令进行组件包上传。</p><h2 id=2-确认组件版本>2. 确认组件版本</h2><p>根据以下两个表格信息，确认需要制作的组件包版本，使用推送脚本或者手动上传组件包到 kubeclipper。</p><p><code>k8s 组件包表</code> 记录当前对象存储里已制作好的各类组件包，后续我们将逐步开源更多组件包以及打包脚本。<br><code>k8s 版本与组件推荐版本对应关系表</code> 记录了各个 k8s 版本对应的组件版本，可以根据自己的需求选择对应的组件版本。</p><h4 id=k8s-版本与组件推荐版本对应关系表>k8s 版本与组件推荐版本对应关系表</h4><table><thead><tr><th style=text-align:left>k8s 版本</th><th style=text-align:left>containerd 版本</th><th style=text-align:left>docker 版本</th><th style=text-align:left>calico 版本</th></tr></thead><tbody><tr><td style=text-align:left>v1.33.0</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>v1.31.1</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>v1.30.6</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>v1.29.4</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>v1.28.0</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>v1.27.4</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>v1.26.7</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>v1.25.4</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.22.4</td></tr><tr><td style=text-align:left>v1.24.8</td><td style=text-align:left>1.6.4</td><td style=text-align:left>-</td><td style=text-align:left>v3.22.4</td></tr><tr><td style=text-align:left>v1.23.9</td><td style=text-align:left>1.6.4</td><td style=text-align:left>20.10.20</td><td style=text-align:left>v3.22.4</td></tr><tr><td style=text-align:left>v1.23.6</td><td style=text-align:left>1.6.4</td><td style=text-align:left>20.10.20</td><td style=text-align:left>v3.22.4</td></tr><tr><td style=text-align:left>v1.22.12</td><td style=text-align:left>1.6.4</td><td style=text-align:left>20.10.20</td><td style=text-align:left>v3.22.4</td></tr><tr><td style=text-align:left>v1.21.14</td><td style=text-align:left>1.6.4</td><td style=text-align:left>20.10.20</td><td style=text-align:left>v3.22.4</td></tr><tr><td style=text-align:left>v1.20.15</td><td style=text-align:left>1.6.4</td><td style=text-align:left>20.10.20</td><td style=text-align:left>v3.16.10</td></tr><tr><td style=text-align:left>v1.19.16</td><td style=text-align:left>1.6.4</td><td style=text-align:left>20.10.20</td><td style=text-align:left>v3.16.10</td></tr><tr><td style=text-align:left>v1.18.20</td><td style=text-align:left>1.6.4</td><td style=text-align:left>20.10.20</td><td style=text-align:left>v3.16.10</td></tr></tbody></table><h4 id=k8s-组件包表>k8s 组件包表</h4><table><thead><tr><th style=text-align:left>组件名称</th><th style=text-align:left>版本</th></tr></thead><tbody><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.33.0</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.31.1</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.30.6</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.29.4</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.28.0</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.27.4</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.26.7</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.25.4</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.24.8</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.23.9</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.23.6</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.22.12</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.21.14</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.20.15</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.19.16</td></tr><tr><td style=text-align:left>k8s</td><td style=text-align:left>v1.18.20</td></tr><tr><td style=text-align:left>containerd</td><td style=text-align:left>1.6.4</td></tr><tr><td style=text-align:left>docker</td><td style=text-align:left>20.10.20</td></tr><tr><td style=text-align:left>calico</td><td style=text-align:left>v3.26.1</td></tr><tr><td style=text-align:left>calico</td><td style=text-align:left>v3.22.4</td></tr><tr><td style=text-align:left>calico</td><td style=text-align:left>v3.21.2</td></tr><tr><td style=text-align:left>calico</td><td style=text-align:left>v3.16.10</td></tr><tr><td style=text-align:left>calico</td><td style=text-align:left>v3.11.2</td></tr></tbody></table><h2 id=3-推送离线组件包到-kubeclipper>3. 推送离线组件包到 kubeclipper</h2><p><code>push_component.sh</code> 脚本：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#8f5902;font-style:italic># usage: ./push_component.sh [component] [version] [arch]</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># usage: ./push_component.sh k8s v1.23.9 amd64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#204a87>type</span> kcctl <span style=color:#000;font-weight:700>&amp;</span>&gt;/dev/null<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  kcctl version
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;kcctl command not found, please install it first!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>PKG_URL_PREFIX</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;https://oss.kubeclipper.io/packages&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>fileList</span><span style=color:#ce5c00;font-weight:700>=()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;k8s&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;calico&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;containerd&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;docker&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;metallb&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;only &#39;k8s&#39;, &#39;calico&#39;,&#39;containerd&#39;,&#39;docker&#39;,&#39;metallb&#39; packages are supported. default: </span><span style=color:#000>$name</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span><span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$2</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> -z <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>version</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Please specify the package version!&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span><span style=color:#000>arch</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$3</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>arch</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;amd64&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>arch</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;arm64&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;only &#39;amd64&#39;, &#39;arm64&#39; architectures are supported. default: </span><span style=color:#000>$arch</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>``</span>
</span></span><span style=display:flex><span><span style=color:#000>build_dir</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span>/<span style=color:#4e9a06>${</span><span style=color:#000>version</span><span style=color:#4e9a06>}</span>/<span style=color:#4e9a06>${</span><span style=color:#000>arch</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span><span style=color:#000>pkg_name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span>-<span style=color:#4e9a06>${</span><span style=color:#000>version</span><span style=color:#4e9a06>}</span>-<span style=color:#4e9a06>${</span><span style=color:#000>arch</span><span style=color:#4e9a06>}</span>.tar.gz
</span></span><span style=display:flex><span><span style=color:#000>pkg_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;k8s&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>packaging<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>$name</span> in
</span></span><span style=display:flex><span>  k8s<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>fileList</span><span style=color:#ce5c00;font-weight:700>=(</span>
</span></span><span style=display:flex><span>      images.tar.gz
</span></span><span style=display:flex><span>      configs.tar.gz
</span></span><span style=display:flex><span>      manifest.json
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>pkg_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;k8s&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;;</span>
</span></span><span style=display:flex><span>  calico<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>fileList</span><span style=color:#ce5c00;font-weight:700>=(</span>
</span></span><span style=display:flex><span>      images.tar.gz
</span></span><span style=display:flex><span>      manifest.json
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>echo</span> -e <span style=color:#4e9a06>&#34;3.26\n</span><span style=color:#4e9a06>${</span><span style=color:#000>version</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>|</span> sort -V <span style=color:#000;font-weight:700>|</span> tail -n 1<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>version</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>      <span style=color:#000>fileList</span><span style=color:#ce5c00;font-weight:700>=(</span>
</span></span><span style=display:flex><span>        images.tar.gz
</span></span><span style=display:flex><span>        charts.tgz
</span></span><span style=display:flex><span>        manifest.json
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#000>pkg_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;cni&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;;</span>
</span></span><span style=display:flex><span>  containerd<span style=color:#000;font-weight:700>|</span>docker<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>fileList</span><span style=color:#ce5c00;font-weight:700>=(</span>
</span></span><span style=display:flex><span>      configs.tar.gz
</span></span><span style=display:flex><span>      manifest.json
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>pkg_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;cri&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;;</span>
</span></span><span style=display:flex><span>  metallb<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>fileList</span><span style=color:#ce5c00;font-weight:700>=(</span>
</span></span><span style=display:flex><span>      images.tar.gz
</span></span><span style=display:flex><span>      manifest.json
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>pkg_type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;metallb&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>esac</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> file in <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>fileList</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;download </span><span style=color:#4e9a06>${</span><span style=color:#000>file</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>...&#34;</span>
</span></span><span style=display:flex><span>    wget <span style=color:#4e9a06>${</span><span style=color:#000>PKG_URL_PREFIX</span><span style=color:#4e9a06>}</span>/<span style=color:#4e9a06>${</span><span style=color:#000>build_dir</span><span style=color:#4e9a06>}</span>/<span style=color:#4e9a06>${</span><span style=color:#000>file</span><span style=color:#4e9a06>}</span> -P <span style=color:#4e9a06>${</span><span style=color:#000>build_dir</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;packaging </span><span style=color:#4e9a06>${</span><span style=color:#000>pkg_name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>...&#34;</span>
</span></span><span style=display:flex><span>  tar -zcvf <span style=color:#4e9a06>${</span><span style=color:#000>pkg_name</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>${</span><span style=color:#000>build_dir</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;packaging </span><span style=color:#4e9a06>${</span><span style=color:#000>pkg_name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06> done&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;push </span><span style=color:#4e9a06>${</span><span style=color:#000>pkg_name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06> to kc...&#34;</span>
</span></span><span style=display:flex><span>  kcctl resource push --pkg <span style=color:#4e9a06>${</span><span style=color:#000>pkg_name</span><span style=color:#4e9a06>}</span> --type <span style=color:#4e9a06>${</span><span style=color:#000>pkg_type</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;push </span><span style=color:#4e9a06>${</span><span style=color:#000>pkg_name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06> to kc done&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>packaging
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;clean up...&#34;</span>
</span></span><span style=display:flex><span>rm -rf <span style=color:#4e9a06>${</span><span style=color:#000>build_dir</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>rm -rf <span style=color:#4e9a06>${</span><span style=color:#000>pkg_name</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;clean up done&#34;</span>
</span></span></code></pre></div><p>使用 <code>push_component.sh</code> 脚本推送组件包到 kubeclipper：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x push_component.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 推送 k8s 组件包</span>
</span></span><span style=display:flex><span>./push_component.sh k8s v1.33.0 amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 推送 calico 组件包</span>
</span></span><span style=display:flex><span>./push_component.sh calico v3.26.1 amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 推送 containerd 组件包</span>
</span></span><span style=display:flex><span>./push_component.sh containerd 1.6.4 amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 推送 docker 组件包</span>
</span></span><span style=display:flex><span>./push_component.sh docker 20.10.20 amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 推送 metallb 组件包</span>
</span></span><span style=display:flex><span>./push_component.sh metallb v0.13.7 amd64
</span></span></code></pre></div><h2 id=4-查看离线组件包>4. 查看离线组件包</h2><p>使用 <code>kcctl resource list</code> 命令查看已上传的离线组件包：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl resource list
</span></span></code></pre></div><h2 id=5-使用离线组件包>5. 使用离线组件包</h2><p>登录 kubeclipper 控制台，点击<code>创建集群</code>，进入<code>集群配置</code>页，<code>镜像类型</code>选择<code>离线</code>，即可选择已上传的离线组件包。</p><p><img src=/images/docs-quickstart/cluster-config01.png alt=集群配置01>
<img src=/images/docs-quickstart/cluster-config02.png alt=集群配置02></p></div><div class=td-content style=page-break-before:always><h1 id=pg-a07813ac798dd2637717ce2e67c448bd>3 - 部署文档</h1><div class=lead>部署示例</div></div><div class=td-content><h1 id=pg-1ed184c63a9ba32659457db911ea314c>3.1 - 部署高可用 KubeClipper</h1><div class=lead>快速部署高可用、生产就绪的 KubeClipper 集群</div><blockquote><p>对于初次接触 KubeClipper，建议部署 AIO 环境，快速上手体验 KubeClipper 提供的功能特性。
对于想将 KubeClipper 应用到生成环境，那么本文档或许对您有所帮助。</p></blockquote><h2 id=概述>概述</h2><p>根据 KubeClipper 架构设计可知，KubeClipper 有以下 4 个核心组件：</p><ul><li>kc-server：主要包括 APISERVER 、控制器、静态资源服务以及内置消息队列等，kc-server 通过消息队列（支持外置）与 kc-agent 通信；kc-server 之间无主从关系，且相互独立；通常部署在独立的节点，从而对外提供稳定可靠的服务。</li><li>kc-agent：主要包括任务处理器，负责接收 kc-server 投递的任务，并反馈任务处理结果；通常部署在需要安装 kubernetes 的节点，是一个超轻量级的服务进程。</li><li>kc-etcd：kc-server 的后端数据库，跟随 kc-server 部署在同一节点上。</li><li>kc-dashboard：图形化管理界面，跟随 kc-server 部署在同一节点。
综上，我们将部署 kc-server 的节点称为 server，部署 kc-agent 的节点称为 agent。</li></ul><p>那么部署高可用 KubeClipper 集群的关键点，就在于如何规划部署 server 节点同时保证 kc-etcd 的高可用。
通常来看，对于部署高可用的分布式应用集群，基本建议节点至少 3 个；同样对于 KubeClipper，3 个节点能保证 kc-server 在其中 2 个节点宕机后依旧可以提供服务，同时能保证 kc-etcd 不会出现脑裂异常。</p><blockquote><p>以上简单介绍了 KubeClipper 架构以及核心组件，是为了更好的理解该如何部署高可用 KubeClipper 集群，从而引出关于对服务器节点规划以及硬件配置要求的思考。</p></blockquote><h2 id=推荐配置>推荐配置</h2><blockquote><p>KubeClipper 作为一个极轻量的 Kubernetes 多集群全生命周期管理工具，本身不会占用太多资源</p></blockquote><p>server 节点</p><ul><li>数量：3 个及以上</li><li>硬件要求：CPU >= 2 核，内存 >= 2GB，硬盘 >= 20GB</li><li>系统：CentOS 7.x / Ubuntu 18.04 / Ubuntu 20.04</li></ul><p>agent 节点</p><ul><li>数量：任意</li><li>硬件要求：依据实际需求而定</li><li>系统：CentOS 7.x / Ubuntu 18.04 / Ubuntu 20.04</li></ul><h2 id=从安装-kcctl-开始>从安装 kcctl 开始</h2><blockquote><p>kcctl 是 KubeClipper 提供的命令行工具，它支持快速部署 KubeClipper 集群以及大部分 Kuberneters 集群管理功能，用以简化运维工作。</p></blockquote><p>安装 kcctl：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 默认安装最新发行版</span>
</span></span><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> bash -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装指定版本</span>
</span></span><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> <span style=color:#000>KC_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>v1.3.1 bash -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 如果您在中国，您可以在安装时指定 KC_REGION 环境变量，此时我们会使用 registry.aliyuncs.com/google_containers 代替 k8s.gcr.io</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 这对于在线安装 k8s 集群非常有用</span>
</span></span><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> <span style=color:#000>KC_REGION</span><span style=color:#ce5c00;font-weight:700>=</span>cn bash -
</span></span></code></pre></div><p>安装成功后，会输出安装版本以及安装路径等信息。</p><blockquote><p>您也可以在 <a href=https://github.com/kubeclipper/kubeclipper/releases>GitHub Release Page</a> 下载指定的 kcctl 版本</p></blockquote><p>验证安装：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl version -o json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kcctl version:
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;major&#34;</span>: <span style=color:#4e9a06>&#34;1&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;minor&#34;</span>: <span style=color:#4e9a06>&#34;3&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;gitVersion&#34;</span>: <span style=color:#4e9a06>&#34;v1.3.1&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;gitCommit&#34;</span>: <span style=color:#4e9a06>&#34;5f19dcf78d3a9dc2d1035a779152fa993e0553df&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;gitTreeState&#34;</span>: <span style=color:#4e9a06>&#34;clean&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;buildDate&#34;</span>: <span style=color:#4e9a06>&#34;2022-12-02T10:12:36Z&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;goVersion&#34;</span>: <span style=color:#4e9a06>&#34;go1.19.2&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;compiler&#34;</span>: <span style=color:#4e9a06>&#34;gc&#34;</span>,
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;platform&#34;</span>: <span style=color:#4e9a06>&#34;linux/amd64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 查看帮助文档</span>
</span></span><span style=display:flex><span>kcctl -h
</span></span></code></pre></div><h2 id=了解-kcctl-deploy-命令>了解 kcctl deploy 命令</h2><blockquote><p>kcctl deploy 命令是专门用于部署 KubeClipper 集群，更多示例以及参数解释请执行 kcctl deploy -h</p></blockquote><p>常用参数简介</p><ul><li>&ndash;server: server 节点 IP，例如 192.168.10.10,192.168.10.11，多个 IP 以逗号隔开。</li><li>&ndash;agent: agent 节点 IP，例如 192.168.10.10,192.168.10.11，多个 IP 以逗号隔开。</li><li>&ndash;pk-file: ssh 免密登录私钥，推荐在命令行使用免密登录。</li><li>&ndash;user: ssh 登录用户名，默认为 root。</li><li>&ndash;passwd: ssh 登录密码，不推荐在命令行使用密码登录。</li><li>&ndash;pkg: 安装包路径，支持本地路径以及在线链接；获取在线安装包链接规则：https://oss.kubeclipper.io/release/{KC_VERSION}/kc-{GOARCH}.tar.gz 。KC_VERSION 为 Release Version 默认设置当前 kcctl 对应版本，GOARCH 为 amd64 或 arm64，默认设置当前 kcctl 的编译架构。</li><li>&ndash;ip-detect: 节点 ip 发现规则，支持多种规则，例如指定网卡名称等，对于多网卡节点非常有用，默认为 &ldquo;first-found&rdquo;。</li></ul><p>了解完 kcctl deploy 的基础使用，那么接下来就开始部署 KubeClipper 集群吧。</p><h2 id=使用-kcctl-部署-kubeclipper>使用 kcctl 部署 KubeClipper</h2><blockquote><p>我们推荐在多节点安装场景中，将涉及到的服务器节点都统一设置免密登录，避免密码明文泄露。</p></blockquote><p>私钥方式部署 3 server 节点：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy --pk-file<span style=color:#ce5c00;font-weight:700>=</span>~/.ssh/id_rsa <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--server SERVER_IPS <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--pkg https://oss.kubeclipper.io/release/<span style=color:#ce5c00;font-weight:700>{</span>KC_VERSION<span style=color:#ce5c00;font-weight:700>}</span>/kc-<span style=color:#ce5c00;font-weight:700>{</span>GOARCH<span style=color:#ce5c00;font-weight:700>}</span>.tar.gz
</span></span></code></pre></div><p>私钥方式部署 3 server + 3 agent 节点，指定 pkg：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy --pk-file<span style=color:#ce5c00;font-weight:700>=</span>~/.ssh/id_rsa <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--server SERVER_IPS <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--agent AGENT_IPS <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--pkg https://oss.kubeclipper.io/release/<span style=color:#ce5c00;font-weight:700>{</span>KC_VERSION<span style=color:#ce5c00;font-weight:700>}</span>/kc-<span style=color:#ce5c00;font-weight:700>{</span>GOARCH<span style=color:#ce5c00;font-weight:700>}</span>.tar.gz
</span></span></code></pre></div><p>私钥方式部署 3 server + 3 agent 节点，未指定 pkg，默认与 kcctl 安装版本一致（推荐）：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy --pk-file<span style=color:#ce5c00;font-weight:700>=</span>~/.ssh/id_rsa <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--server SERVER_IPS <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--agent AGENT_IPS
</span></span></code></pre></div><p>私钥方式部署 3 server + 3 agent 节点，指定 etcd 端口，默认端口为 client-12379 | peer-12380 | metrics-12381：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl deploy --pk-file<span style=color:#ce5c00;font-weight:700>=</span>~/.ssh/id_rsa <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--server SERVER_IPS <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--agent AGENT_IPS <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--etcd-port <span style=color:#0000cf;font-weight:700>12379</span> --etcd-peer-port <span style=color:#0000cf;font-weight:700>12380</span> --etcd-metric-port <span style=color:#0000cf;font-weight:700>12381</span>
</span></span></code></pre></div><blockquote><p>参数输入示例：<br>SERVER_IPS: 192.168.10.20,192.168.10.21<br>AGENT_IPS: 192.168.10.30,192.168.10.31<br>KC_VERSION: KubeClipper 的 release version，查看 <a href=https://github.com/kubeclipper/kubeclipper/releases>GitHub Release Page</a> 获取<br>GOARCH：系统架构，amd64 （又名 x84_64），arm64（又名 aarch64）</p></blockquote><p>kcctl deploy 支持多种参数，能够满足您对部署 KubeClipper 集群的特定需求，更多功能等您探索。<br>在执行 kcctl deploy 命令后，命令会检测您的环境是否符合安装要求，会将警告信息、安装进度等同步输出到控制台，最后在安装成功后会打印如下 KubeClipper banner：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> _   __      _          _____ _ _
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> / /     <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>        /  __ <span style=color:#4e9a06>\ </span><span style=color:#ce5c00;font-weight:700>(</span>_<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>/ / _   _<span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>__   ___<span style=color:#000;font-weight:700>|</span> /  <span style=color:#4e9a06>\/</span> <span style=color:#000;font-weight:700>|</span>_ _ __  _ __   ___ _ __
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span>    <span style=color:#4e9a06>\|</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#4e9a06>&#39;_ \ / _ \ |   | | | &#39;</span>_ <span style=color:#4e9a06>\|</span> <span style=color:#4e9a06>&#39;_ \ / _ \ &#39;</span>__<span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span><span style=color:#4e9a06>\ </span> <span style=color:#4e9a06>\ </span><span style=color:#000;font-weight:700>|</span>_<span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>_<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000;font-weight:700>|</span>  __/ <span style=color:#4e9a06>\_</span>_/<span style=color:#4e9a06>\ </span><span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>_<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>_<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000;font-weight:700>|</span>  __/ <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>\_</span><span style=color:#000;font-weight:700>|</span> <span style=color:#4e9a06>\_</span>/<span style=color:#4e9a06>\_</span>_,_<span style=color:#000;font-weight:700>|</span>_.__/ <span style=color:#4e9a06>\_</span>__<span style=color:#000;font-weight:700>|</span><span style=color:#4e9a06>\_</span>___/_<span style=color:#000;font-weight:700>|</span>_<span style=color:#000;font-weight:700>|</span> .__/<span style=color:#000;font-weight:700>|</span> .__/ <span style=color:#4e9a06>\_</span>__<span style=color:#000;font-weight:700>|</span>_<span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>                                 <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>   <span style=color:#000;font-weight:700>|</span> <span style=color:#000;font-weight:700>|</span>
</span></span><span style=display:flex><span>                                 <span style=color:#000;font-weight:700>|</span>_<span style=color:#000;font-weight:700>|</span>   <span style=color:#000;font-weight:700>|</span>_<span style=color:#000;font-weight:700>|</span>
</span></span></code></pre></div><p>系统默认管理账号：<code>admin / Thinkbig1</code></p><p>登录控制台：
打开浏览器，访问 <code>http://SERVER_IP</code> （通过任意一个 Server 节点均可访问）即可进入 KubeClipper 控制台</p><p><img src=/images/docs-quickstart/console-login.png alt=console></p><p>登录命令行：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl login -H http://SERVER_IP -u admin -p Thinkbig1
</span></span></code></pre></div><blockquote><p>大多数 kcctl 命令都依赖登录状态，因此最好在执行 cli 命令时提前登录。</p></blockquote><h2 id=使用-kcctl-添加-agent-节点到-kubeclipper>使用 kcctl 添加 agent 节点到 KubeClipper</h2><blockquote><p>当前 kcctl join 命令仅支持添加 agent 节点，后续会逐步支持添加 server 节点。
新加入的 agent 节点也应该统一设置免密登录，且私钥相同。</p></blockquote><p>Join agent 节点：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl join --agent<span style=color:#ce5c00;font-weight:700>=</span>AGENT_IPS
</span></span></code></pre></div><h2 id=使用-kcctl-从-kubeclipper-中删除-agent-节点>使用 kcctl 从 KubeClipper 中删除 agent 节点</h2><blockquote><p>当前 kcctl drain 命令仅支持删除 agent 节点，后续会逐步支持删除 server 节点。</p></blockquote><p>Drain agent 节点：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl drain --agent<span style=color:#ce5c00;font-weight:700>=</span>AGENT_IPS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 强制 drain 节点，忽略错误</span>
</span></span><span style=display:flex><span>kcctl drain --agent<span style=color:#ce5c00;font-weight:700>=</span>AGENT_IPS --force
</span></span></code></pre></div><p>如果您发现根据本文档无法成功部署 KubeClipper，请移步 <a href=https://github.com/kubeclipper/kubeclipper/issues>KubeClipper Github Issue</a>，提出您的意见或反馈。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8dbd4e302cd86a4d0f71f71ce3b300de>4 - 使用手册</h1><div class=lead>用户使用手册</div></div><div class=td-content><h1 id=pg-2cc05f33f011eb2f0671dd748cff9826>4.1 - 创建集群</h1><div class=lead>KubeClipper 支持通过向导式页面创建 kubernetes 集群，并安装 CNI、CSI 等所需插件。</div><h2 id=创建集群准备工作>创建集群准备工作</h2><ol><li>您需要准备充足的可用节点，如需添加节点，参见“<a href=/docs/tutorials/node-management/#%E6%B7%BB%E5%8A%A0%E8%8A%82%E7%82%B9>添加节点</a>”教程。</li><li>准备好需要部署的 kubernetes、CRI、calico、CSI 和其他插件的镜像或二进制文件，kubeclipper 提供了推荐的版本，您可以根据平台所处网络环境，选择在线 / 离线后，直接在页面上选取使用。您也可以将部署所需的镜像上传至自己的镜像仓库，并在部署时指定。更多安装配置，参考“<a href=#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE>集群配置</a>”章节。</li></ol><h2 id=创建单节点实验集群>创建单节点实验集群</h2><ol><li><p>点击“集群管理”>“集群”，进入集群列表页面，点击左上角“创建集群”按钮。</p></li><li><p>进入创建集群向导页面的“节点配置”页面。填写“集群名称”，如 “test”，不需选择“集群模版”。选择一个可用节点，添加为控制节点，并在污点管理列表中，将 master 节点的污点移除。点击“下一步”按钮。</p></li></ol><p><img src=/images/docs-tutorials/aio.png alt></p><ol start=3><li><p>进入创建集群向导页面的“集群配置”页面。选择“离线安装”，“镜像仓库”不需填写，其他配置都可使用默认配置，点击“快速创建”按钮，跳转配置确认页面，点击“确认”按钮。</p></li><li><p>单节点的实验集群创建完成，您可以在集群详情页查看集群详情，也可以点击“查看日志”按钮，查看集群创建过程中的实时日志。</p></li></ol><h2 id=使用镜像仓库创建集群>使用镜像仓库创建集群</h2><p>如果创建的集群中包含较大的镜像，推荐您将所有镜像上传到特定的镜像仓库，创建集群会更快速更顺畅。</p><ol><li>添加镜像仓库。点击“集群管理”>“镜像仓库”，进入镜像仓库列表页面，点击左上角“添加”按钮。在添加镜像仓库的弹窗中输入镜像仓库名称和存放有镜像的仓库地址，点击“确定”按钮。</li><li>创建集群。点击“集群管理”>“集群”，进入集群列表页面，点击左上角“创建集群”按钮。按需配置集群节点，在“集群配置”页面的“镜像仓库”中，选择第一步添加的镜像仓库，根据需要完成集群其他配置后创建集群。</li></ol><h2 id=使用集群模版创建集群>使用集群模版创建集群</h2><p>您可以使用集群模版，简化集群创建流程。</p><ol><li>添加模版。保存模版有两种方式，您可以在“集群管理”>“模版管理”页面，添加集群模版，以备创建集群时使用。也可以点击集群操作中的“更多”>“保存为模版”，将已存在的集群配置保存为模版，以便创建出和该集群同等配置的 kubernetes 集群。</li><li>创建集群。点击“集群管理”>“集群”，进入集群列表页面，点击左上角“创建集群”按钮，进入创建集群页面，填写“集群名称”，如 “demo”，选择第一步中保存的集群模版，添加所需节点，点击右下角“快速创建”按钮，跳转至“配置确认”页面，核对模版信息无误后，点击“确认”按钮，创建集群。</li></ol><h2 id=集群配置指南>集群配置指南</h2><h3 id=节点配置>节点配置</h3><p>在节点配置页面，您可以对节点进行以下配置：</p><ul><li>区域：集群所属区域，添加节点时可为节点指定物理的或逻辑的区域，使用该区域下节点创建的 kubernetes 集群也属于该区域，不支持使用跨区域的多个节点创建集群。</li><li>控制节点：为集群指定奇数个的控制节点，生产环境一般使用3个控制节点以实现高可用。</li><li>工作节点：根据业务规模，为新集群添加工作节点。</li><li>污点管理：您可以为已添加的节点配置污点，kubeclipper 会自动为控制节点添加不允许调度（noschedule）的污点，您也可以根据需要进行更改。</li><li>节点标签：您可以根据需要为已添加的集群节点配置标签。</li></ul><p>您可以按业务需要配置所需节点。如果需要创建非高可用的实验集群，也可以仅添加一个控制节点，并将控制节点自动添加的污点移除，详细操作参见“<a href=#%E5%88%9B%E5%BB%BA%E5%8D%95%E8%8A%82%E7%82%B9%E5%AE%9E%E9%AA%8C%E9%9B%86%E7%BE%A4>创建单节点实验集群</a>”。</p><h3 id=集群配置>集群配置</h3><p>在集群配置页面，您可以对集群进行以下配置：</p><ul><li>安装方式和镜像仓库：</li></ul><table><thead><tr><th></th><th>镜像仓库为空</th><th>指定镜像仓库</th></tr></thead><tbody><tr><td><strong>在线（公网环境）</strong></td><td>配置包来源：从 kubeclipper.io 下载。<br>镜像拉取方式：镜像默认从官方镜像仓库拉取，如 kubernetes 镜像从 k8s.gcr.io 拉取、calico 从 docker.io 拉取。如果您设置了国内镜像代理，镜像会从您指定的 “KC_IMAGE_REPO_MIRROR” 代理仓库拉取。</td><td>配置包来源：从 kubeclipper.io 下载。<br>镜像拉取方式：从填写的镜像仓库拉取，组件将默认继承该仓库地址，请确保该仓库存在相关组件镜像；组件也会提供独立的镜像仓库参数，设置后组件镜像从该地址拉取。</td></tr><tr><td><strong>离线（内网环境）</strong></td><td>配置包来源：从本地 kubeclipper 集群 server 节点下载，您可以使用 kcctl resource list 命令查看本地可用配置包，或使用 kcctl resource push 命令上传所需配置包。<br>镜像拉取方式：从本地 kubeclipper 集群 server 节点下载，下载后由 CRI 进行镜像导入。您可以使用 kcctl resource list 命令查看本地可用镜像包，或使用 kcctl resource push 命令上传所需镜像包。</td><td>配置包来源：从本地下载，您可以使用 kcctl resource list 命令查看本地可用配置包，或使用 kcctl resource push 命令上传所需配置包。<br>镜像拉取方式：从填写的镜像仓库拉取，组件将默认继承该仓库地址，请确保该仓库存在相关组件镜像；组件也会提供独立的镜像仓库参数，设置后组件镜像从该地址拉取。kubeclipper 提供 Docker Registry 方案，并使用 kcctl registry 命令行进行管理，您也可以使用其他自有镜像仓库。</td></tr></tbody></table><ul><li><p>kubernetes 版本：指定集群 kubernetes 版本。当您选择离线安装的时候，可以从当前环境中配置包的 kubernetes 版本中选择；当您选择在线安装的时候，可以从 kubeclipper 官方推荐的版本中选择。</p></li><li><p>ETCD 数据目录：可指定 ETCD 数据目录，默认为/var/lib/etcd。</p></li><li><p>kubelet 数据目录：可指定 kubelet 数据目录，默认为 /var/lib/kubelet。</p></li><li><p>CertSANs：kubernetes 集群 ca 证书签名的 ip 或者域名，可填写多个。</p></li><li><p>容器运行时：根据指定 kubernetes 版本，kubernetes 版本在 v1.20.0 之前，容器运行时默认 docker，之后默认 containerd；v1.24.0 之后不支持 docker。</p></li><li><p>容器运行时版本：指定 containerd / docker 版本。与 kubernetes 相同，当您选择离线安装的时候，可以从当前环境中配置包的版本中选择；当您选择在线安装的时候，可以从 kubeclipper 官方推荐的版本中选择。</p></li><li><p>Containerd 数据目录：可填写 config.toml 配置中的 root dir，默认为/var/lib/containerd。</p></li><li><p>Docker 数据目录：可填写 daemon.json 配置中的 root dir，默认为/var/lib/docker。</p></li><li><p>Containerd 镜像仓库：存放 containerd 镜像的仓库地址，config.toml 配置中的 registry.mirrors，可填写多个。</p></li><li><p>Docker 镜像仓库：存放 docker 镜像的仓库地址，daemon.json 配置中的 insecure registry,可填写多个。</p></li><li><p>DNS 域名：kubernetes 集群的域名，默认为 cluster.local。</p></li><li><p>Worker 负载 IP：用于 worker 节点到多 master 的负载均衡，单一 master 不需要设置。</p></li><li><p>外部访问 IP：可以填写一个浮动 IP 给用户访问，可为空。</p></li><li><p>备份空间：集群备份文件存储位置。</p></li></ul><h3 id=cni-配置>CNI 配置</h3><p>当前版本仅支持 Calico 作为集群 CNI。</p><p>Calico 将用户设置的 pod cidr 分为若干个 block (网段)，根据业务需求动态的分配给需要的节点，并在节点中通过 bgp peer 维护集群节点的路由表。</p><p>例如：容器的地址池：172.25.0.0/16，动态分配的网段池: 172.25.0.0 - 172.25.255.192 (172.25.0.0/26 即 10 个比特位)，动态分配的网段数: 1023，每个网段的 pod 数量为: 61 (193-254)，总 pod 数量为1023 * 61 = 62403，相对最大节点数(按照200业务 pod 为基准值)：312。</p><p>目前不建议大于50个节点的集群，大于50个节点的集群建议手动配置 route reflection，用来优化集群中的节点的路由表维护的稳定性。</p><p>使用 Calico 作为集群 CNI，您需要进行以下配置：</p><ul><li><p>Calico 模式：支持5种网络模式：</p><ul><li>Overlay-IPIP-All: 使用 IP-in-IP 技术打通不同节点的 pod 的网络,通常这样的方式使用在底层平台是 iaas 的环境之中,当然如果你底层网路环境直接是物理设备的也完全可以使用只不过效率和灵活度都会大打折扣,需要注意的是你需要确认底层网络环境(underlay)是支持 IPIP 协议的.(使用 overlay 的网络方式对网络性能造成一定的影响)。</li><li>Overlay-Vxlan-All: 使用 IP-in-IP 技术打通不同节点的 pod 的网络,通常这样的方式使用在底层平台是 iaas 的环境之中,当然如果你底层网路环境直接是物理设备的也完全可以使用只不过效率和灵活度都会大打折扣,他理论上可以在任何的网络环境上运行,通常在底层环境不支持 IPIP 协议的时候我们会使用他.(使用 overlay 的网络方式对网络性能造成一定的影响)。</li><li>BGP: 使用 IP-in-IP 技术打通不同节点的 pod 的网络,通常这样的方式使用在裸机的环境上,当然底 Iaas 平台支持 BGP 的话也是可以使用的,这种模式下 pod 的 ip 通信是通过 集群中的各个节点中互相交换路由表来完成 pod 之间的通信的,如果你需要手动打通多个集群之间的 pod 网络需要注意你分配的地址断不应该有冲突。</li><li>Overaly-IPIP-Cross-Subnet: 使用 IP-in-IP 技术打通不同节点的 pod 的网络,通常这样的方式使用在底层平台是 iaas 的环境之中,需要注意的是你需要确认底层网络环境(underlay)是支持 IPIP 协议的.和 Overlay-IPIP-All 的不同之处在于,如果 2 个不同节点但在同一个网段中的上 pod 互相通信时是通过路由表,这样可以提高在不同节点但在同一个网段中的上 pod 互相通信时的效率。</li><li>Overaly-Vxlan-Cross-Subnet: 和 Overaly-IPIP-Cross-Subnet 逻辑相似不再做重复的解释。</li></ul></li><li><p>Calico 版本：指定 calico 版本。与 kubernetes 相同，当您选择离线安装的时候，可以从当前环境中配置包的版本中选择；当您选择在线安装的时候，可以从 kubeclipper 官方推荐的版本中选择。</p></li><li><p>IP版本：可指定 IP 版本为 IPV4 或 IPV4 IPV6 双栈。</p></li><li><p>服务子网：填写 service 子网 CIDR，v4 默认为：10.96.0.0/16，v6 默认为 fd03::/112，注意 Service 网络不得与任何主机网络重叠。</p></li><li><p>Pod CIDR：填写 Pod 子网 CIDR，v4 默认：172.25.0.0/24，v6 默认为 fd05::/120，注意 Pod 网络不得与任何主机网络重叠。</p></li><li><p>pod网路的底层：</p><ul><li>first-found（默认）：程序会根据 ipfamily (v4 或 v6)遍历所有的有效的 ip 地址（local,loop back，docker bridge等会被自动排除）通常如果是多网卡时会排除默认网关以外的网卡的 ip 作为节点之间的路由地址。</li><li>can-reach：通过检查域名或者 ip 的可达性来设置节点之间的路由地址。</li><li>interface：根据正则表达式获取所有满足的网卡设备名称并返回第一个满足表达式网卡的地址作为节点之间的路由地址。</li></ul></li><li><p>MTU：为 Calico 环境配置最大传输单元(MTU)，建议不大于1440，默认为1440，详情见 <a href=https://docs.projectcalico.org/networking/mtu>https://docs.projectcalico.org/networking/mtu</a>。</p></li></ul><h3 id=存储配置>存储配置</h3><p>Kubeclipper当前版本内置了 NFS 作为集群外接存储。</p><p>对接 NFS 类型的外接存储，您需要设置以下内容：</p><table><thead><tr><th>字段</th><th>作用说明</th><th>填写说明/可选项</th></tr></thead><tbody><tr><td><strong>服务地址</strong></td><td>ServerAddr，NFS的服务地址</td><td>必填</td></tr><tr><td><strong>共享路径</strong></td><td>SharedPath，NFS的服务挂载路径</td><td>必填</td></tr><tr><td><strong>存储类</strong></td><td>StorageClassName，存储类的名称</td><td>默认为 nfs-sc，可自定义名称，不可与集群其他存储类重复</td></tr><tr><td><strong>回收策略</strong></td><td>ReclaimPolicy，VPC回收策略</td><td>删除 Delete / 保留 Retain</td></tr><tr><td><strong>挂载选项</strong></td><td>MountOptions，NFS 的 options 参数，如nfsvers=3</td><td>选填，可填写多个</td></tr><tr><td><strong>副本数</strong></td><td>Replicas，NFS provisioner副本数</td><td>默认为1</td></tr></tbody></table><p>设置完外接存储后，下方卡片会显示您已经开启的存储，您可以选择一个存储类作为默认存储，对于未指定特定StorageClass 的 PVC ，会直接使用默认的存储类。</p><h3 id=配置确认>配置确认</h3><p>您可以在配置确认页面浏览集群的配置信息，确认无误后，点击“确认“按钮。也可以点击卡片右侧的“编辑”按钮，跳回到相应步骤修改集群信息。</p><p>安装集群可能需要较长时间，您可以在集群详情页面查看操作日志，跟踪集群安装状态。</p><h3 id=设置国内镜像代理可选>设置国内镜像代理（可选）</h3><blockquote><p>Q: 设置国内镜像代理有什么作用？</p><p>A: 设置了国内镜像代理，使用在线安装功能时，会从指定代理拉取 kubernetes 相关镜像，避免在国内无法访问 gcr 而导致集群安装失败问题。</p></blockquote><p>以下设置方法需在执行 <code>kcctl deploy</code> 部署命令的机器上完成，任选其一即可。</p><p>**方式一：**设置 KC_IMAGE_REPO_MIRROR 环境变量（推荐）</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 设置环境变量，推荐使用阿里云镜像代理，您也可以自行设定</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>KC_IMAGE_REPO_MIRROR</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;registry.aliyuncs.com/google_containers&#34;</span>
</span></span></code></pre></div><p>**方式二：**设置 /etc/kc/kc.env 环境变量文件</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 创建 kc 目录</span>
</span></span><span style=display:flex><span>mkdir -pv /etc/kc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 创建 kc.env 文件并传入环境变量信息</span>
</span></span><span style=display:flex><span>cat <span style=color:#4e9a06>&lt;&lt;EOF &gt; /etc/kc/kc.env
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>KC_IMAGE_REPO_MIRROR=&#34;registry.aliyuncs.com/google_containers&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>EOF</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-d02d74740bfa769ed1533f083ba56ac2>4.2 - 集群托管</h1><div class=lead>对于在 kubeclipper 平台外运行的 kubernetes 集群，您可以托管至 kubeclipper 平台内进行管理，当前版本支持托管 kubeadmin 集群。</div><h2 id=kubeadm-集群托管>Kubeadm 集群托管</h2><p>托管由 kubeadm 创建和管理的 kubernetes 集群，kubeclipper 会通过 kubeconfig 文件，获取集群和节点信息，并导入到 kubeclipper 平台中。</p><p>点击“集群管理”>“集群托管”按钮进入集群托管页面，点击左上角“添加”按钮，在添加提供商弹窗中，填写提供商名称（如 kubeadm-demo）和描述后，填写以下信息：</p><ul><li>区域：提供商下的集群和节点在 kubeclipper 平台中的所属区域。</li><li>提供商类型：选择 kubeadm。</li><li>节点连接方式：集群节点的连接方式，可以选择“私钥”或者“密码”，您需要确保可以通过所选方式 ssh 到集群节点。<ul><li>选择“私钥”，需要输入节点用户名和私钥信息。</li><li>选择“密码”，需要输入节点用户名和密码信息。</li></ul></li><li>集群名称：作为在本平台的展示名称，不能与其他集群重复。</li><li>KubeConfig：托管集群的 KubeConfig 文件。</li></ul><p>填写完成后点击“确定”按钮，将集群和节点导入到平台中。点击提供商名称（kubeadm-demo），进入提供商详情页，您可以查看提供商下的集群，并对提供商执行以下操作：</p><ul><li>同步：系统将每隔4小时定期同步集群信息，您也可以点击“同步”按钮手动执行。</li><li>编辑：编辑提供商的名称、描述、访问信息、节点连接方式。</li><li>移除：移除集群信息，但集群不会被卸载。</li></ul><h2 id=托管集群管理>托管集群管理</h2><p>您可以点击“集群管理”>“集群”进入集群列表页面，查看包括托管集群和本地集群在内的所有集群列表，对于不同集群，支持的管理操作如下表所示：</p><p>注意：托管的 kubeadm 集群安装插件或外接存储的镜像来源会默认使用 docker.io，如果您处于离线环境，需要在安装插件时填写可访问的离线镜像仓库地址，该离线镜像仓库的地址需要预先添加到 cri 的私有镜像仓库配置，参见 <a href=/docs/tutorials/cluster-management/#cri-%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE>CRI 镜像仓库配置</a> 。</p><table><thead><tr><th><strong>功能</strong></th><th><strong>Kubeclipper 创建的集群</strong></th><th><strong>托管的 kubeadm 集群</strong></th></tr></thead><tbody><tr><td>查看日志</td><td>✔︎</td><td>✔︎</td></tr><tr><td>任务失败后重试</td><td>✔︎</td><td>✔︎</td></tr><tr><td>访问 kubectl</td><td>✔︎</td><td>✔︎</td></tr><tr><td>编辑</td><td>✔︎</td><td>✔︎</td></tr><tr><td>保存为模版</td><td>✔︎</td><td>✘</td></tr><tr><td>CRI 镜像仓库配置</td><td>✔︎</td><td>✔︎</td></tr><tr><td>添加/移除集群节点</td><td>✔︎</td><td>✔︎</td></tr><tr><td>备份和恢复管理</td><td>✔︎</td><td>✔︎</td></tr><tr><td>版本升级</td><td>✔︎</td><td>✘</td></tr><tr><td>删除集群</td><td>✔︎</td><td>✘</td></tr><tr><td>移除集群（提供商）</td><td>/</td><td>✔︎</td></tr><tr><td>重置状态</td><td>✔︎</td><td>✔︎</td></tr><tr><td>集群插件管理</td><td>✔︎</td><td>✔︎</td></tr><tr><td>更新集群证书</td><td>✔︎</td><td>✔︎</td></tr><tr><td>查看 kubeconfig</td><td>✔︎</td><td>✔︎</td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-a8bf4ad6bad192cf81433dc9082057f8>4.3 - 集群管理</h1><div class=lead>kubeclipper 支持对 kubernetes 集群的全生命周期管理。</div><h2 id=集群操作日志查看>集群操作日志查看</h2><p>在集群详情页面，点击“操作日志”标签页，可以查看集群操作日志列表。点击操作日志右侧“查看日志”按钮，可以在弹窗中查看全部步骤和节点的详细日志。点击左侧步骤名称，可查看执行步骤详细的日志输出。</p><p>在集群操作执行过程中，点击查看日志，您可以实时查看到日志更新来跟踪操作执行情况。对于执行失败的任务，您也可以通过查看日志，找到红色圆点标注的执行步骤和节点，快速定位错误，排查操作失败原因。</p><p><img src=/images/docs-tutorials/log.png alt></p><h3 id=任务失败后重试>任务失败后重试</h3><p>对于任务执行失败，但排查错误原因后不需要修改任务参数的情况，您可以点击操作日志右侧的“从断点处重试”按钮，从断点处重新执行任务。</p><p>注意：重试操作并不是万能的，您需要自行判断任务执行失败的原因，处理后如果不需要更改执行任务时填写的参数，就可以点击重试按钮，从错误处重新开始执行。</p><p>集群操作（如创建、恢复、升级等）执行失败，可能会导致集群状态显示为“xx失败”并无法正常执行其他操作，如果从断点处重试也无法执行成功，您可以参考运维文档，手动修复集群问题。问题修复后，您可以点击集群右侧“更多”>“集群状态”>“重置状态”按钮，重置集群至正常状态。</p><h2 id=访问集群-kubectl>访问集群 kubectl</h2><p>Kubectl 是 Kubernetes 命令行工具，您可以用它在 Kubernetes 集群上运行命令。Kubectl 可用于部署应用、查看和管理集群资源、查看日志等。</p><p>您可以访问运行中集群的 kubectl，点击集群操作中的“更多“>”访问 kubectl”，就可以在集群 kuebectl 弹窗中执行 kubectl 命令行操作。</p><p><img src=/images/docs-tutorials/kubectl.png alt></p><h2 id=集群设置>集群设置</h2><h3 id=编辑>编辑</h3><p>您可以点击集群列表右侧“更多”>“集群设置”>“编辑”按钮，编辑集群描述、备份空间、外部访问 IP、集群标签信息。</p><h3 id=保存为模版>保存为模版</h3><p>您可以点击集群列表右侧“更多”>“集群设置”>“保存为模版”按钮，将集群信息保存为模版，以便再次创建相似配置的集群时使用。</p><h3 id=cri-镜像仓库配置>CRI 镜像仓库配置</h3><p>Docker 和 Containerd 使用 dockerhub 作为默认镜像仓库，如果您需要使用其他镜像仓库（特别是使用自签名 https 仓库或者 http 仓库），您需要配置 CRI 镜像仓库。</p><p>点击集群右侧“更多”>“集群设置”>“CRI 镜像仓库”按钮，在 CRI 镜像仓库弹窗中，配置您需要的镜像仓库，您可以选择平台中已存在的镜像仓库，也可以临时填写镜像仓库地址。对于自签名 https 仓库或者 http 仓库，建议您先在“集群管理”>“镜像仓库”页面添加仓库信息，再在此操作中配置。</p><h2 id=集群节点管理>集群节点管理</h2><p>在集群详情页的“节点”列表页面，您可以查看当前集群中的节点列表，节点的规格、状态和角色信息。</p><p><img src=/images/docs-tutorials/cluster.png alt></p><h3 id=添加集群节点>添加集群节点</h3><p>当集群负载较高时，您可以通过为集群添加节点来达到主动扩容的目的，添加新的“节点”不会影响现有的业务的运行。</p><p>在集群详情页的节点列表标签页下，点击左侧的“添加节点”按钮，在弹窗中选择可用节点，设置节点标签，点击“确认”按钮。当前版本仅支持添加工作节点。</p><h3 id=移除集群节点>移除集群节点</h3><p>在集群详情页的节点列表标签页下，您可以点击节点右侧的 “移除”按钮移除节点。当前版本仅支持移除工作节点。</p><p>注意：移除集群节点，您需要注意生产中的安全问题，避免应用发生中断。</p><h2 id=集群备份和恢复>集群备份和恢复</h2><p>KubeClipper 对 kubernetes 集群的备份主要为备份 ETCD 数据库数据，以及 kubernetes 的资源对象备份，如 namespace，deployment、configMap。对资源自身产生的文件和数据不做备份，例如对集群中运行的 mysql pod，该 mysql pod 产生的数据和文件，不会为之备份，同理，文件类的 pv 对象下的文件，也不做备份，仅仅备份 pv 这个对象。KubeClipper 提供的备份功能是热备份，备份期间不影响集群的使用。KubeClipper 虽然不反对在集群 &ldquo;繁忙期&rdquo; 备份，但也强烈不赞成在集群 &ldquo;繁忙期&rdquo; 备份。</p><h3 id=创建备份空间>创建备份空间</h3><p>执行备份之前，您需要先为集群设置备份空间，即设置备份文件的存储位置。备份空间的存储类型可以是 FS 存储或 S3 存储，下面以节点本地存储、NFS 存储和 MINIO 存储为例：</p><ul><li><strong>节点本地存储（仅适用单节点实验集群）：</strong></li></ul><ol><li>创建存储目录。连接集群 master 节点终端（可参见<a href=/docs/tutorials/node-management/#%E8%BF%9E%E6%8E%A5%E7%BB%88%E7%AB%AF>连接节点终端</a>），使用 mkdir 命令，在 master 节点中创建“/root/backup”目录。</li><li>创建备份空间。点击“集群管理”>“备份空间”，进入备份空间列表页，点击右上角“创建”按钮，在创建备份空间弹窗中，输入“备份空间名称”，如 “local”，选择“存储类型”为 “FS”，填写“备份路径”，如 “/root/backup”。</li><li>设置集群备份空间。创建集群时，在“集群配置”页面选择“备份空间”为 “local”，或者编辑已有集群，在编辑集群弹窗中的“备份空间”中选择 “local”。</li></ol><p>注意：使用本地节点存储备份文件，不需要引入外部存储，缺点是如果本地节点遭到破坏，备份文件也会丢失，所以强烈不赞成在生产环境中使用。</p><ul><li><strong>NFS：</strong></li></ul><ol><li><p>准备 NFS 存储。准备一台 NFS 服务，并在 NFS 服务器上创建一个用于存放备份文件的目录，如 “/data/kubeclipper/cluster-backups”。</p></li><li><p>挂载存储目录。连接集群 master 节点终端（可参见<a href=/docs/tutorials/node-management/#%E8%BF%9E%E6%8E%A5%E7%BB%88%E7%AB%AF>连接节点终端</a>），使用 mkdir 命令，在每个 master 节点中创建 “/data/kubeclipper/cluster-backups” 目录，并 mount 到 NFS 服务器的 /data/kubeclipper/cluster-backups 目录即可。</p><p>命令示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mount -t nfs <span style=color:#ce5c00;font-weight:700>{</span> NFS_IP <span style=color:#ce5c00;font-weight:700>}</span>:/data/kubeclipper/cluster-backups /opt/kubeclipper/cluster-backups -o <span style=color:#000>proto</span><span style=color:#ce5c00;font-weight:700>=</span>tcp -o nolock
</span></span></code></pre></div></li><li><p>创建备份空间。点击“集群管理”>“备份空间”，进入备份空间列表页，点击右上角“创建”按钮，在创建备份空间弹窗中，输入“备份空间名称”，如 “nfs”，选择“存储类型”为 “FS”，填写“备份路径”为 “/opt/kubeclipper/cluster-backups”。</p></li><li><p>设置集群备份空间。创建集群时，在“集群配置”页面选择“备份空间”为 “nfs”，或者编辑已有集群，在编辑集群弹窗中的“备份空间”中选择 “nfs”。</p></li></ol><ul><li><strong>MINIO：</strong></li></ul><ol><li>准备 MINIO 存储。搭建 MINIO 服务，部署过程参考官网 <a href=https://docs.min.io/docs/minio-quickstart-guide.html>https://docs.min.io/docs/minio-quickstart-guide.html</a>，也可以使用已有 MINIO 服务。</li><li>创建备份空间。点击“集群管理”>“备份空间”，进入备份空间列表页，点击右上角“创建”按钮，在创建备份空间弹窗中，输入“备份空间名称”，如 “minio”，选择“存储类型”为 “S3”，填写 “bucket 名称”，如 “kubeclipper-backups”，该 bucket 将由 kubeclipper 自动创建，“Endpoint” 中填写第一步 MINIO 存储服务的 ip 和端口号，填写服务用户名和密码，点击“确定”按钮。</li><li>设置集群备份空间。创建集群时，在“集群配置”页面选择“备份空间”为 “minio”，或者编辑已有集群，在编辑集群弹窗中的“备份空间”中选择“minio”。</li></ol><p>您可以在“集群管理”的“备份空间”页面查看所有备份空间列表和详细信息，并执行以下操作：</p><ul><li><p>编辑：编辑备份空间描述，和 S3 类型备份空间的用户名/密码。</p></li><li><p>删除：删除备份空间，备份空间下存在备份文件的，不允许删除。</p></li></ul><h3 id=集群备份>集群备份</h3><p>您可以点击集群操作中的“更多”>“备份和恢复”> “集群备份”按钮，备份集群 ETCD 数据。</p><p>您可以在集群详情页面的备份标签页下，查看当前集群的所有备份文件，还可以对备份执行以下操作：</p><ul><li><p>编辑：编辑备份描述。</p></li><li><p>恢复：执行集群恢复操作，将集群恢复至指定备份状态。</p></li><li><p>删除：删除指定备份文件。</p></li></ul><h3 id=定时备份>定时备份</h3><p>您也可以为集群创建定时备份，点击集群操作中的“更多”>“备份和恢复”> “定时备份”按钮，在定时备份弹窗中，输入定时备份名称、执行类型（重复执行/仅执行一次）和执行时间，并为重复执行的定时备份设置有效备份个数，点击“确认”按钮。</p><p>kubeClipper 会在您设置的执行时间为集群执行备份任务，备份文件会自动命名为“集群名称-定时备份名称-随机码”，对于重复执行的定时备份，kubeClipper 会在该定时任务下的备份文件超过有效备份个数时，自动删除超出个数的较早的备份文件。</p><p>定时备份添加完成后，可以在集群详情页的“定时备份”标签页查看定时备份信息，也可以在“备份”标签页查看定时备份产生的备份文件。</p><p>对于定时备份任务，您还可以执行以下操作：</p><ul><li><p>编辑：编辑定时备份任务执行时间，和重复执行的定时备份的有效备份个数。</p></li><li><p>启用/禁用：禁用的定时备份任务将暂时停止执行。</p></li><li><p>删除：删除定时备份任务。</p></li></ul><h3 id=集群备份恢复>集群备份恢复</h3><p>如果您在集群正常运行期间执行恢复操作，则 KubeClipper 将对该集群进行覆盖式恢复，就是备份文件里面的 etcd 数据，覆盖现有的数据。</p><p>您可以在集群详情页的备份标签页下，点击备份右侧的 “恢复”按钮；或点击集群操作中的“更多”>“备份和恢复”>“恢复集群”按钮，在恢复集群弹窗中选择需要恢复的备份，可以将当前集群恢复至指定备份状态。</p><p>注意：集群升级后，将无法再恢复到升级前版本的备份。</p><h2 id=集群状态>集群状态</h2><h3 id=集群版本升级>集群版本升级</h3><p>如当集群版本不满足需要，您可以为集群升级 kubernetes 版本。与创建集群一样，您需要准备好集群版本所需配置包和目标版本的 kubernetes 镜像并上传至指定位置，详情参见<a href=/docs/tutorials/create-clusters/#%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C>创建集群准备工作</a>。</p><p>点击集群操作的“更多”>“集群状态”> “集群升级”按钮，在集群升级弹窗中选择安装方式和镜像仓库，选择升级的目标版本，升级的安装方式和 kubernetes 版本的配置与创建集群相同，详情参见<a href=/docs/tutorials/create-clusters/#%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE>集群配置指南</a>。</p><p>集群升级可以跨小版本，但不支持略过次版本的升级，如您可以从 v1.20.2 升级到 v1.20.13，或由 v1.20.x 升级到 v1.21.x，但不支持从 v1.20.x 升级到 v1.22.x。对于 1.23.x 版本，暂不支持升级到 1.24.x 版本。</p><p>升级集群操作可能需要较长时间，您可以在集群详情页面查看操作日志，跟踪集群升级状态。</p><h3 id=删除集群>删除集群</h3><p>您可以点击集群列表右侧“更多”>“集群状态”> “删除”按钮，删除集群。</p><p>注意删除后集群不可恢复。请谨慎操作。如果集群对接了外部存储，回收策略为“保留”的存储类中的数据卷会被保留，您可以通过其他方式访问，或手动删除；回收策略为“删除”的存储类中的数据卷，会在删除集群时自动删除。</p><h3 id=重置状态>重置状态</h3><p>集群操作（如创建、恢复、升级等）执行失败，可能会导致集群状态显示为“xx失败”并无法正常执行其他操作，如果从断点处重试也无法执行成功，您可以参考运维文档，手动修复集群问题。问题修复后，您可以点击集群右侧“更多”>“集群状态”>“重置状态”按钮，重置集群至正常状态。</p><h2 id=集群插件管理>集群插件管理</h2><p>除了在创建集群时安装插件，您也可以为运行中的集群安装存储和其他自定义插件。以安装存储插件为例，点击集群操作中的“更多”>“插件管理”>“添加存储项”按钮，进入添加存储项页面，可以为集群安装存储插件，安装配置与创建集群中的配置相同。</p><p>对于已安装的插件，您可以在集群详情页查看插件信息，并执行以下操作：</p><ul><li><p>保存为模版：将插件信息保存为模版，以便为其他集群使用。</p></li><li><p>移除插件：卸载集群插件。</p></li></ul><h2 id=集群证书管理>集群证书管理</h2><h3 id=更新集群证书>更新集群证书</h3><p>kubernetes 集群证书默认有效期为一年，您可以在集群详情页的基本信息中查看证书过期时间，证书过期前一天，您也可以在集群列表看到证书过期的提醒。更新集群证书，您可以点击集群操作中的“更多”>“集群证书”>“更新集群证书”按钮，更新集群全部证书。</p><h3 id=获取-kubeconfig-文件>获取 kubeconfig 文件</h3><p>您可以点击集群操作中的“更多”>“集群证书”>“查看 kubeconfig 文件”按钮，查看集群 kubeconfig 文件，也可以点击弹窗中的“下载”按钮，下载 kubeconfig 文件。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-14a1d24a0e318e4086c90931bd9e8c35>4.4 - 节点管理</h1><div class=lead>KubeClipper 支持跨区域的节点和集群管理。</div><h2 id=区域管理>区域管理</h2><p>平台支持多区域管理，即为平台管理的所有节点和集群进行物理或逻辑的区域划分。您可以在“区域管理”页面查看平台内管理的所有区域，点击区域名称，进入区域详情页面，可以查看区域下的所有集群列表和节点列表。</p><p><img src=/images/docs-tutorials/region.png alt></p><h2 id=节点管理>节点管理</h2><p>您可以在“节点信息”页面查看平台中管理的全部节点列表，和节点规格、状态等信息。点击节点名称进入节点详情页面，可以查看详细的节点基本信息和系统信息。</p><p>KubeClipper 中的节点状态表示 kc-agent 对节点的管理状态。正常情况下，节点状态显示为“就绪”，当节点失联4分钟（误差时间 10s 内）后，状态会更新为“未知”，未知状态的节点无法进行任何操作，也无法创建集群或为集群添加/移除节点。</p><h3 id=添加节点>添加节点</h3><p>在部署 KubeClipper 时，您就可以添加初始的 server 节点和 agent 节点，其中，server 节点用于部署 KubeClipper 自身服务，agent 节点可用于部署 kubernetes 集群。在用于实验或开发的 KubeClipper 环境，您可以将 server 节点同时添加为 agent 节点。但如果用于生产环境，建议不要将 server 节点复用为 agent 节点。</p><p>您也可以使用 kcctl join 命令为 KubeClipper 添加 agent 节点。同时，您可以为每个 agent 节点标记一个区域，区域可以是物理的或逻辑的位置，您可以使用同一区域的节点创建 kubernetes 集群，但不可以使用跨区域的节点创建集群。未标记区域的节点默认属于 default 区域。</p><p>命令行示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kcctl join --agent beijing:1.2.3.4 --agent shanghai:2.3.4.5
</span></span></code></pre></div><h3 id=移除节点>移除节点</h3><p>当您不再需要某些节点，可以使用 kcctl drain 命令将节点从平台中移除。</p><p>命令行示例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kcctl drain --agent 192.168.10.19
</span></span></code></pre></div><h3 id=连接终端>连接终端</h3><p>在节点列表页面，您可以点击目标节点右侧的“连接终端”按钮，在连接终端的弹窗中输入节点端口和用户名密码信息后，访问节点 SSH 控制台并执行命令。</p><h3 id=启用禁用节点>启用/禁用节点</h3><p>您可以点击节点右侧“禁用”按钮暂时禁用节点，禁用状态下的节点不允许创建或添加到集群。</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9db4787abe05db7c233072bf3fa9f94e>4.5 - 访问控制</h1><div class=lead>KubeClipper 访问控制功能使用指南。</div><h2 id=用户管理>用户管理</h2><p>安装 KubeClipper 之后，您需要创建所需角色的用户。一开始，系统默认只有一个用户 admin，具有平台管理员角色。</p><p>点击“访问控制”>“用户”，进入用户管理页面，点击左上角“创建用户”按钮，在弹窗中填写用户名、密码、手机号码、邮箱等信息，并指定用户角色，点击“确认”按钮。系统内置四个角色如下：</p><ul><li><p>平台管理员：拥有集群管理、用户管理、审计管理等全部平台查看和操作权限。</p></li><li><p>集群管理员：拥有所有集群管理权限。</p></li><li><p>用户管理员：拥有所有用户管理权限。</p></li><li><p>平台只读用户：拥有全部平台查看权限。</p></li></ul><p>用户创建完成后，您可以在用户详情页面查看用户详情信息，并执行以下操作：</p><ul><li><p>编辑：编辑用户别名、角色、手机号、邮箱信息。</p></li><li><p>编辑密码：编辑用户登录密码。</p></li><li><p>删除：删除用户。</p></li></ul><p>在用户详情页面，您还可以查看当前用户的登录日志列表。</p><p>您可以编辑平台 /etc/kubeclipper-server/kubeclipper-server.yaml 文件，根据需要设置用户登录日志的最大保留条数和保留期限，每个用户的登录日志超过最大条数后，超过最大条数和期限的日志会被自动删除，仅超过保留期限但未超过最大条数的日志数据将不会被删除。</p><h2 id=自定义角色>自定义角色</h2><p>除了系统内置角色，您也可以创建自定义角色，以满足业务需要。</p><p>点击“访问控制”>“角色”，进入角色管理页面，您可以点击左上角“创建角色”按钮，创建自定义角色。</p><p>在创建角色页面，您需要填写角色名称和描述，并勾选自定义角色所需权限，一些权限依赖于其他权限，在选择这些权限时，将自动选中依赖的权限。</p><p>创建自定义角色完成后，您可以在角色详情页面查看角色基本信息、角色权限列表、授权用户列表，并对自定义角色执行以下操作：</p><ul><li><p>编辑：编辑自定义角色别名。</p></li><li><p>编辑权限：编辑自定义角色下的权限。</p></li><li><p>删除：删除自定义角色，需确保没有用户使用待删除角色。</p></li></ul><h2 id=接入外部用户>接入外部用户</h2><p>KubeClipper 可以通过 OIDC 协议使用外部用户登录。</p><p>首先，平台管理员需要登录平台 server 节点，在 kubeclipepr-server.yaml 文件中的 authentication 下插入以下信息：</p><pre tabindex=0><code class=language-undefined data-lang=undefined>oauthOptions:
    identityProviders:
    - name: keycloak
      type: OIDC
      mappingMethod: auto
      provider:
        clientID: kc
        clientSecret: EErn729BB1bKawdRtnZgrqj9Bx0]mzUs
        issuer: http://172.20.163.233:7777/auth/realms/kubeclipper
        scopes:
        - openid
        - email
        redirectURL: http://{kc-console-address}/oatuh2/redirect/{IDP-Name}
</code></pre><p>其中，“provider” 下需要您填写自己的 OAuth2 服务的<code>clientID</code>、<code>clientSecret</code>、<code>issuer</code>信息，以 keycloack 为例，如下图所示。</p><p><img src=/images/docs-tutorials/keycloak-clients.png alt></p><p><img src=/images/docs-tutorials/keycloak-secret.png alt></p><p><code>redirectURL</code>示例：http://172.0.0.90/oauth2/redirect/keycloack</p><p>OAuth2 用户可以通过以下步骤访问和使用 KubeClipper 平台：</p><ol><li>点击登录页的 “OAuth2 登录”按钮，进入 OAuth2 登录页面，输入用户名密码登录，进入 KubeClipper 平台，首次登录，您会因未被授予权限而无法访问平台。</li><li>平台管理员或其他拥有用户管理权限的用户登录 KubeClipper，在用户管理页面，找到目标 OAuth2 用户，通过编辑用户指定用户角色。</li><li>OAuth2 用户重复第一步，登录 KubeClipper，就可以正常访问平台并执行角色权限内操作。</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-2a24abb89b7115d59d639d3389ce3c9b>5 - 常见问题</h1><div class=lead>常见问题记录</div></div><div class=td-content><h1 id=pg-54fa90c08fd01c12b3bbec84936325aa>5.1 - 通过 kcctl 命令创建集群错误</h1><div class=lead>在 v1.2.1 版本（包括 v1.2.1）之前，使用 <code>kcctl create cluster</code> 命令创建集群功能，会发生创建失败错误，以下提供一种临时的解决方法。 在 v1.2.1 版本之后，我们修复了该问题。</div><h2 id=问题复现>问题复现</h2><p>安装 v1.2.1 版本的 kcctl</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sfL https://oss.kubeclipper.io/get-kubeclipper.sh <span style=color:#000;font-weight:700>|</span> <span style=color:#000>KC_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span>v1.2.1 bash -
</span></span></code></pre></div><p>通过 kcctl deploy 命令部署 KubeClipper 集群</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 安装 AIO 环境</span>
</span></span><span style=display:flex><span>kcctl deploy
</span></span></code></pre></div><p>通过 kcctl create cluster 命令创建 kubernetes 集群</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 需要先登录</span>
</span></span><span style=display:flex><span>kcctl login --host http://127.0.0.1 --username admin --password Thinkbig1
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 创建集群</span>
</span></span><span style=display:flex><span>kcctl create cluster --name <span style=color:#204a87>test</span> --master 192.168.10.98 --untaint-master
</span></span></code></pre></div><p>登录 KubeClipper 管理界面，查看创建集群操作日志，日志显示在安装 cni 过程中发现下载 calico v3.21.2 404 无法找到</p><p><img src=/images/docs-faq/create-cluster-error.png alt></p><h2 id=问题修复-pr>问题修复 PR</h2><p>提交已经合并到了 master，PR：https://github.com/kubeclipper/kubeclipper/commit/7e6eb0ed199ff1cb00fde0c2624c62cdc5ca0b9c</p><p>但 v1.2.1 已经发布了，按照发版规范无法在该版本打补丁，需要等到后续 v1.2.2 发布解决，因此我们提供一种临时方案来解决这个问题。</p><h2 id=解决方法>解决方法</h2><p>制作离线资源包
下载 calico v3.21.2 的安装包，打包为指定格式的离线资源包</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 创建资源目录</span>
</span></span><span style=display:flex><span>mkdir -pv calico/v3.21.2/amd64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 下载 v3.21.2 版本的 calico</span>
</span></span><span style=display:flex><span>wget -P calico/v3.21.2/amd64 https://oss.kubeclipper.io/packages/calico/v3.21.2/amd64/images.tar.gz
</span></span><span style=display:flex><span>wget -P calico/v3.21.2/amd64 https://oss.kubeclipper.io/packages/calico/v3.21.2/amd64/manifest.json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 压缩文件为指定命令</span>
</span></span><span style=display:flex><span>tar -zcvf calico-v3.21.2-amd64.tar.gz calico
</span></span></code></pre></div><p>推送离线资源包</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 推送</span>
</span></span><span style=display:flex><span>kcctl resource push --pkg calico-v3.21.2-amd64.tar.gz --type cni
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 验证</span>
</span></span><span style=display:flex><span>kcctl resource list<span style=color:#000;font-weight:700>|</span>grep v3.21.2
</span></span></code></pre></div><blockquote><p>如果在执行 <code>kcctl resource push</code> 报了如下错误：
<img src=/images/docs-faq/need-login.png alt>
解决方法如下：</p><ol><li>编辑 /root/.kc/deploy-config.yaml 文件。</li><li>找到 ssh 配置项，添加 pkFile 字段配置，值为当前服务器的 ssh 公钥文件的绝对路径。<br><img src=/images/docs-faq/add-key.png alt></li></ol></blockquote><p>通过命令行安装 kubernetes 集群，在 KubeClipper 管理后台查看操作日志</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kcctl create cluster --name <span style=color:#204a87>test</span> --master 192.168.10.98 --untaint-master
</span></span></code></pre></div><p>查看 kubernetes 集群 pods 运行状态</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -A
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8efbf7499fe9c7bde8d2c1bb7ff6ee3c>6 - 贡献指南</h1><div class=lead>如何为 kubeclipper 做贡献</div><p>请查看 <a href=https://github.com/kubeclipper/community>KubeClipper Community</a></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/kubeclipper/kubeclipper aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2025 KubeClipper a Series of LF Projects, LLC. For website terms of use, trademark policy and other project policies please see https://lfprojects.org/policies/ 保留所有权利</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>隐私政策</a></small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin=anonymous></script></body></html>